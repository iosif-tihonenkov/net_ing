# BGP

## Два вида протокола

### IGP

IGP является внутренним протоколом (по отношению к моей AS — автономной системе)

Внутренние протоколы я уже проходил — это EIGRP, OSPF. Еще не проходил — ISIS, RIP.

### EGP

EGP  является внешним протоколом.
Представляет только один протокол — EBGP или BGP (что проще — не «ебижипи» же?)

BGP обеспечивает передачу маршрутов между различными сетями (AS).

Что такое AS — это система IP-сетей и маршрутизаторов, управляемых одним или несколькими операторами, имеющими единую пполитику маршрутизации с интернетом. 

## Дальнейшее деление
<img width="1065" height="758" alt="image" src="https://github.com/user-attachments/assets/64b2faae-4965-4c66-bdd6-c0d0fb3d4ffe" />
### iBGP
iBGP — необходим для передачи BGP-маршрутов внутри одной AS

### EBGP
EBGP — BGP МЕЖДУ AS

## Сходства

1. Оба опираются на один из двух алгоритмов — DV (distance vector — протокол дистанционно-векторной маршрутизаии) или LS (link state — протокол основанный на LS — пара «соседство-стоимость».


## Как устанавливается соедининение

Два устройства, между которыми установлена BGP-сессия — BGP-пиры или BGP-соседи

Эти соседи не устанавливаются автоматически. Их необходимо настроить вручную. 

1. Изначальное состояние BGP-соседства — IDLE (ничего не происходит). В этом состоянии BGP находится в случае, если нет маршрута к BGP-пиру.

Посмотреть состояние можно по команде `show ip bgp neighbor`.
<img width="846" height="775" alt="image" src="https://github.com/user-attachments/assets/634dcd82-5305-46cb-8b03-cbad3efbbf2c" />


2. Для надежности BGP использует TCP (мы как то обсуждали, что это хоть не самый быстрый, но надежный протокол. Его брат — UDP (по ходу приемный)).


BGP-маршрутизатор слушаеn и посылает пакеты на 179 TCP порт.
<img width="669" height="129" alt="image" src="https://github.com/user-attachments/assets/5928d0cf-9149-4ee8-8d9c-ab03cf54535c" />


Когда слушает — состояние CONNECT. 
Когда отправил и ждет ответ от соседа — состояние ACTIVE.

Маршутизатор R1 отправляет TCP SYN на 179 порт BGP-пира и таким образом инициирует TCP сессию. 
R2  возвращает R1 TCP ACK (ответ на SYN R1) и посылает свой TCP SYN.
R1 возвращает R2 TCP ACK (о том, что получил SYN).

Итого — состояние установлено. 

<img width="406" height="26" alt="image" src="https://github.com/user-attachments/assets/b1598c37-33d1-49e0-ad7b-ef9a62a607eb" />

