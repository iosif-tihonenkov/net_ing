# Настрока OSPF на оборудовании CISCO

Привет! Сегодня настроим OSPF в двух сценариях:
- На двух узлах;
- На трех узлах;

## Что такое OSPF
Если кратко - OSPF это протокол внутридоменной динамической маршрутизатации с учетом состояния каналов. 

Довольно широко используется. На мой взгляд - похож на протокол EIGRP.

При проектировании OSPF есть понятие "Зона" - "Area". Это позволяет сегментировать сеть. Что то похожее у EIGRP с AS. 

В каждой зоне есть свой Designated router (DR) - что то вроде главное роутера - назначенный маршрутизатор. У него есть BDR - его зам, если что то случится с DR. 

Они вдвоем - единственные устройства, которые могут генерировать LSA в своей зоне. LSA - Link State Advertisement - сообщение о состоянии канала между маршрутизаторами, который формируется при помощи Hello сообщений. 

DR и BDR оппределяются автоматически на основании Priority ID. Формируется на основании самого большого IP, либо может быть изменен вручную. 

**Зачем вообще нужны DR и BDR? **

Все маршрутизаторы в AREA передааются техническую инфомрацию о себе, своих соединениях именно им. Если кто то подключается новой - он первым делом выясняет в AREA, кто именно тут DR и BDR и налаживает с ними контакт. 

Уже после этого DR и BDR высчитывают COST маршрутов, заносят  себе в таблицу маршрутизации и синхронизируют свои базы даанных со всей остальной AREA. 

## Вариант №1 - два узла
### Топология
- Два VPCS;
- Два маршрутизатора Cisco C3745;

<img width="1259" height="344" alt="image" src="https://github.com/user-attachments/assets/d010368a-0ca8-4775-b5cd-1684f0b28858" />

Собственно на скриншоте прекрасно видно - какие сети, какие порта и т.п. 

### Настройка

По сути, настройка обоих роутеров будет практически идентична: 

R1
```
В режиме глобальной конфигурации:
router ospf 1    ! Запускаем процесс OSPF с номером 1 (да, у нас может быть несколько разных процессов OSPF)
network 10.0.1.0 0.0.0.255 area 0    ! Анонсируем сеть 10.0.1.0/24 в зоне 0
network 172.16.0.0 0.0.0.255 area 0    ! Анонсируем сеть 172.16.0.0/16 в зоне 0
```

R2
```
В режиме глобальной конфигурации:
router ospf 1    ! Запускаем процесс OSPF с номером 1
network 192.168.0.0 0.0.0.255 area 0    ! Анонсируем сеть 192.168.0.0/24 в зоне 0
network 172.16.0.0 0.0.0.255 area 0    ! Анонсируем сеть 172.16.0.0/16 в зоне 0
```

### Проверка
Проверить можно командами ```show ip ospf neighbors```:
<img width="1399" height="907" alt="image" src="https://github.com/user-attachments/assets/e84211a2-9074-476b-8d74-0c8843d8c9d2" />


и ```show ip route```: 
<img width="1194" height="785" alt="image" src="https://github.com/user-attachments/assets/0b4f7102-0283-4d17-8eee-ecef7532731f" />

Буква "О" - указывает на маршрут с OSPF протоколом

## Вариант №2 - три узла и две зоны 
### Топология
- Два VPCS;
- Три маршрутизатора CISCO C3745;
<img width="1269" height="435" alt="image" src="https://github.com/user-attachments/assets/8766b862-85aa-42da-85e7-2481fcc3796e" />

На данном скриншоте также прекрасно видно где какие интерфейсы, сети. Единственное, что добавилось - разделение на AREA и добавился ABR. 
Что такое ABR - это Area Border Router - граничный маршрутизатор. Когда нам нужно связять две разные AREA - он именно тот, кто нам нужен. Он по сути входит в обе AREA и позволяет между ними пересылать данные. 
Самый такой пример, который приходит на ум - это Route-on-a-Stick в плане VLAN. 
  
### Настройка
R3
```
В режиме глобальной конфигурации:
router ospf 1    ! Запускаем процесс OSPF с номером 1
router-id 1.1.1.1 ! Задаем Router ID (RID)
network 10.0.1.0 0.0.0.255 area 0    ! Анонсируем сеть 10.0.1.0/24 в зоне 0
network 172.16.0.0 0.0.0.255 area 0    ! Анонсируем сеть 172.16.0.0/24 в зоне 0
```
R4
```
router ospf 1
network 172.16.0.0 0.0.0.255 area 0
network 192.168.0.0 0.0.0.255 area 1
router-id 2.2.2.2
```
R5
```
router ospf 1
network 192.168.0.0 0.0.0.255 area 1
network 90.10.0.0 0.0.0.255 area 1
router-id 3.3.3.3
```

У тебя возникает вопрос - а нахрена мы здаем RID? Тут лучше меня ответит ИИ:

*В контексте мультизональной конфигурации R4 особенно важно иметь четко определенный RID, так как он:
-Отвечает за передачу информации между зонами
-Участвует в формировании LSA типа 3 (Summary LSA)
-Служит точкой синхронизации баз данных между area 0 и area 1*

### Проверка
Во-первых - мы можем открыть WireShark и увидеть Hello Packet по протоколу OSPF. 
Во-вторых - мы можем пингануть с одного PC на другой. И то и другое - на скрине ниже: 
<img width="1896" height="945" alt="image" src="https://github.com/user-attachments/assets/c5736b47-df00-4ad5-bd38-b67fd31f7dfa" />


